(function(T,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("@jtopo/core")):typeof define=="function"&&define.amd?define(["exports","@jtopo/core"],l):(T=typeof globalThis<"u"?globalThis:T||self,l(T.jtopoEditor={},T.jtopo))})(this,function(T,l){"use strict";function W(a,e){const t=at();return W=function(n,s){return n=n-310,t[n]},W(a,e)}const V=W;(function(a,e){const t=W,n=a();for(;[];)try{if(parseInt(t(313))/1+-parseInt(t(328))/2*(parseInt(t(315))/3)+parseInt(t(322))/4*(parseInt(t(326))/5)+-parseInt(t(319))/6*(parseInt(t(321))/7)+parseInt(t(327))/8*(parseInt(t(316))/9)+-parseInt(t(330))/10*(parseInt(t(314))/11)+-parseInt(t(310))/12*(-parseInt(t(324))/13)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(at,653571);function at(){const a=["187iTVfAK","479211sKQzfb","2511VniJAT","style","initDom","4839906cLiyhs","add","7OmHqwr","2924suGFOf","dargItem","7643116aXkaMl","innerHTML","2665aCSgtN","19336lWbOqN","8dlEqed","domElement","262130XrAxDO","div","getDragItem","12mNUJCx","iconHtml","stage","892893dkcKtc"];return at=function(){return a},at()}class se extends l.EventTarget{constructor(e){const t=W;super(),this[t(312)]=e,this.domElement,this.initDom(),this.hide()}[V(318)](){const e=V;let t=document.createElement("div");return t.classList[e(320)]("jtopo_iconsPanel"),this.stage.layersContainer.appendChild(t),this.domElement=t,this}hide(){const e=V;return this[e(329)][e(317)].display="none",this}show(){const e=V;return this.domElement[e(317)].display="block",this}[V(332)](){return this[V(323)]}setConfig(e){let t=this;return e.items.forEach(function(n){const s=W;let x=document.createElement(s(331));x.classList.add("item"),x[s(325)]=n[s(311)],x.setAttribute("draggable",!![]),x.ondragstart=function(i){t.dargItem=n},t.domElement.appendChild(x)}),this}}function rt(){const a=["getFolder","remove","globalAlpha","7SitXRB","连线属性","onChange","setCurrentObject","10daLwDy","3946328QeNgXc","addFolder","hide","__folders","showProperty","8490600AbQEdr","isLink","边框粗细","1644TFbvQn","keys","图片路径","19510YpJYoH","12px","editor","removeAll","fontSize","gui","8GcmpRT","getCtrollerValue","object","stage","lineCap","GUI","name","onFinishChange","sans-serif","open","setValue","backgroundColor","1402179rMvXfs","lineDash","text","节点属性","32058917UmojiT","domElement","1424495LMBEPw","strokeStyle","3499908IVDyyf","target","basic","setFolderValues","style","forEach","attachTo","block","imageSrc","Arial","getCtroller","add","newFolder","字体名称","width"];return rt=function(){return a},rt()}const L=K;(function(a,e){const t=K,n=a();for(;[];)try{if(parseInt(t(320))/1+parseInt(t(362))/2*(-parseInt(t(314))/3)+-parseInt(t(322))/4+parseInt(t(356))/5*(-parseInt(t(353))/6)+parseInt(t(340))/7*(-parseInt(t(345))/8)+parseInt(t(350))/9+parseInt(t(344))/10*(parseInt(t(318))/11)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(rt,975354);function K(a,e){const t=rt();return K=function(n,s){return n=n-309,t[n]},K(a,e)}class xe{constructor(e,t){const n=K;this.editor=e,this.dat=t,this.gui=new t[n(367)],this[n(364)],this.folders={}}[L(343)](e){const t=L,n=this.editor,s=this.editor.stage;s.inputSystem[t(323)]=e,s.selectedGroup[t(359)]().add(e),e[t(351)]?n.linkCtrlBox[t(328)](e):e.isNode&&n.nodeCtrlBox[t(328)](e),n.update(),this[t(349)](e)}showProperty(e){const t=L;if(e==null)return;this.basic={id:e.id,name:"",x:1,y:1,imageSrc:"",width:1,height:1,text:"",rotation:0};const n=this.editor[t(365)],s=n.styleSystem.currentTheme,x=s.getStyle(e.className);this.style={lineDash:null,backgroundColor:"",textAlign:x.textAlign||"center",textBaseline:x.textAlign||"middle",strokeStyle:x.strokeStyle||"gray",fillStyle:"",color:x.color||"",borderWidth:0,fontSize:t(357),fontFamily:"arial",lineWidth:x.lineWidth||0,lineCap:"butt",globalAlpha:1};const i=this.basic,r=this.style;Object.keys(i).forEach(function(o){if(e[o]!=null){let c=e[o];i[o]=c}}),Object[t(354)](r).forEach(function(o){let h=e[t(326)][o];e.style[o]!=null&&(r[o]=h)}),this.object==null&&(this.object=e,this.init()),this.object=e,r.borderWidth=e.style.borderWidth||0,r.fontWeight=e.style.fontWeight,r[t(360)]=e.style[t(360)],r.fontFamily=e[t(326)].fontFamily,this.setFolderValues(i,r),e.isNode&&this.getFolder("节点属性")!=null?(this.getFolder("节点属性").show(),this[t(337)](t(341))[t(347)]()):this[t(337)]("连线属性")!=null&&(this.getFolder("连线属性").show(),this.getFolder(t(317)).hide())}newFolder(e){const t=L,n=this.gui[t(346)](e);return this.folders[e]=n,n}[L(337)](e){return this.folders[e]}[L(363)](e,t){return this.getCtroller(e,t).getValue()}[L(332)](e,t){return this.getFolder(e).__controllers.find(s=>s.property==t)}[L(325)](e,t){const n=L;Object[n(354)](this[n(361)][n(348)])[n(327)](x=>{this.gui.__folders[x].__controllers.forEach(function(o){const c=K;let h=o.property;e[h]!=null?o[c(312)](e[h]):t[h]!=null&&o[c(312)](t[h])})})}init(){const e=L,t=this,n=this[e(358)],s=n[e(365)],x=this[e(324)],i=this.style;let r={实线:"","虚线1,1":"1,1","虚线2,2":"2,2","虚线3,3":"3,3","虚线7,3":"7,3","虚线3,7":"3,7","虚线10,1":"10,1","虚线1,10":"1,10"},o=[e(331),"serif",e(310)],c={默认:"butt",圆形:"round",矩形:"square"};function h(){const C=e;let k=this.property,m=this.getValue(),M=t.object;M[C(330)]!=null&&(M.style[C(313)]=null),M[k]=m,n.update()}function d(){const C=e;let k=this.property,m=this.getValue(),M=t.object;k==C(315)?m==null||m==""?m=null:typeof m=="string"&&(m=m.split(",")):k=="backgroundColor"&&t[C(364)][C(351)]&&(m=null),M.imageSrc!=null&&(M.style.backgroundColor=null),M.css(k,m),n.update()}const u=this.newFolder("基础属性");u.add(x,"name")[e(309)](h).name("name"),u.add(x,e(316)).onFinishChange(h)[e(368)]("文字"),u.add(i,e(339),0,1,.1)[e(342)](d).name("整体透明度"),u[e(333)](i,e(321))[e(309)](d)[e(368)]("线条颜色"),u.open();const f=this[e(334)]("节点属性");f[e(333)](x,"x").onFinishChange(h),f[e(333)](x,"y").onFinishChange(h),f.add(x,e(336),1).onFinishChange(h).name("宽度"),f.add(x,"height",1)[e(309)](h).name("高度"),f[e(333)](i,"borderWidth",0,10)[e(342)](d).name(e(352)),f.add(i,"lineWidth",0,10)[e(342)](d).name("线条粗细"),f.add(i,"lineDash",r).onChange(d).name("虚实"),f.add(i,"fillStyle").onFinishChange(d).name("填充颜色"),f.add(x,"imageSrc").onFinishChange(h).name(e(355)),f.open();const b=this.newFolder("连线属性");b.add(i,"lineWidth",0,100)[e(342)](d)[e(368)]("线条粗细"),b.add(i,"lineDash",r).onChange(d).name("虚实"),b.add(i,e(366),c).onChange(d)[e(368)]("末端样式"),b.open();const S=this.newFolder("文本");S.add(i,"fontFamily",o).onChange(d).name(e(335)),S[e(333)](i,e(360),1,1e3).onChange(d).name("大小"),S.add(i,"color").onChange(d)[e(368)]("颜色"),S[e(311)]();let P=this.gui.domElement;P[e(338)](),s.layersContainer.appendChild(P),P[e(326)].position="absolute",P.style.right="-15px",P.style.top="0px",P.style.zIndex=1e3}open(){this.gui.open()}close(){this.gui.close()}hide(){this.gui.domElement.style.display="none"}show(){const e=L;this[e(361)][e(319)].style.display=e(329)}}const j=ot;function ot(a,e){const t=ct();return ot=function(n,s){return n=n-337,t[n]},ot(a,e)}(function(a,e){const t=ot,n=a();for(;[];)try{if(-parseInt(t(341))/1+parseInt(t(345))/2*(parseInt(t(347))/3)+-parseInt(t(344))/4*(parseInt(t(353))/5)+-parseInt(t(343))/6*(-parseInt(t(349))/7)+parseInt(t(339))/8*(parseInt(t(340))/9)+parseInt(t(350))/10+-parseInt(t(351))/11===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(ct,692333);const Jt=11,p={data:{localLastDocName:"topo_last_doc"},anchorPoint:{size:Jt,style:{strokeStyle:"gray",fillStyle:"rgba(255,255,255,0.6)",lineWidth:1},activeStyle:{fillStyle:j(337)},unActiveStyle:{fillStyle:j(342)},drawStartMinDistance:Jt,drawStartDelay:200},anchorBox:{anchorDist:Jt/2,nodeDist:12},nodeResizePoint:{width:12,height:12,style:{border:"1px solid black",backgroundColor:"orange"}},nodeRotatePoint:{width:14,height:14,style:{lineWidth:1,strokeStyle:"black",fillStyle:j(338)},rotateLineStyle:{strokeStyle:"gray"},rotateLineLength:30},guildLine:{styleW:{strokeStyle:"#c8c8c8",lineDash:[1,1]},styleS:{strokeStyle:"#c8c8c8",lineDash:[1,1]}},linkCtrlPoint:{size:7,style:{lineWidth:1,strokeStyle:j(348),fillStyle:"pink"},activeStyle:{strokeStyle:"rgba(0,0,0,0.1)",fillStyle:j(352)},unactiveStyle:{strokeStyle:"rgba(0,0,0,0.9)",fillStyle:"pink"},adjustStyle:{strokeStyle:"gray",fillStyle:j(338)},ctrlLinkStyle:{lineDash:[2,2]}},dropBox:{style:{border:j(346),lineDash:[5,3]}},align:{minDistance:10,alignLineStyle:{strokeStyle:"orange",lineDash:[5,3]}},operationTip:{enable:!![]}};function ct(){const a=["1690uYlgmG","red","orange","8bDQHkX","9198963rHFtiS","733526HlvxJG","rgba(255,255,255,0.6)","11622TDAGpO","1304GbIEhj","1929766OBJzsY","3px solid orange","3mKOLrE","gray","4809jCQWDo","7351390XPFhdX","27684811UrKWZX","rgba(0,0,0,0.1)"];return ct=function(){return a},ct()}const Zt=lt;(function(a,e){const t=lt,n=a();for(;[];)try{if(-parseInt(t(130))/1+parseInt(t(140))/2+parseInt(t(138))/3*(parseInt(t(131))/4)+parseInt(t(129))/5*(-parseInt(t(134))/6)+-parseInt(t(132))/7+parseInt(t(141))/8*(parseInt(t(136))/9)+-parseInt(t(133))/10*(-parseInt(t(135))/11)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(dt,710676);function lt(a,e){const t=dt();return lt=function(n,s){return n=n-129,t[n]},lt(a,e)}const v=navigator.userAgent.toUpperCase().indexOf("MAC OS")!=-1?"Meta":"Control";function dt(){const a=["7882399pBsxoR","2780yKLLYa","6468186MUmGMt","115313kAisAI","218808rUGpKZ","Escape","359028YnfCFI","ArrowDown","410336pWGtxx","32muEwRA","5WUjyNp","421602vvEmRJ","4iRYvWW"];return dt=function(){return a},dt()}const ht={CtrlOrCmd:v,CreateGroup:v,DropTo_leader:"Shift",Delete:["Delete","Meta+Backspace"],Select_all:[v+"+a"],Select_invert:[v+"+i"],Cut:[v+"+x"],Copy:[v+"+c"],Paste:[v+"+v"],Save:[v+"+s"],Open:[v+"+o"],Undo:[v+"+z"],Redo:[v+"+shift+z"],Copy_style:["Shift+c"],paste_Style:["Shift+v"],Move_up:["ArrowUp"],Move_down:[Zt(139)],Move_left:["ArrowLeft"],Move_right:["ArrowRight"],Layout_tree:["t"],Layout_grid:["g"],LocalView:["/"],ResizeKeepAspectRatio:"shift",DrawLine:["l"],Cancel:[Zt(137)],DiableNodeAlign:"Alt"};(function(a,e){for(var t=ft,n=a();[];)try{var s=-parseInt(t(472))/1+parseInt(t(469))/2*(parseInt(t(474))/3)+-parseInt(t(476))/4+parseInt(t(470))/5+parseInt(t(477))/6+parseInt(t(471))/7+-parseInt(t(473))/8;if(s===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(ut,343308);function ut(){var a=["4eULQak","36370HFRISF","2459009hvylcw","291814GOGaxq","3154656OocmBs","841497FOWHYE","type","363356AbinyD","1204404CRSxep"];return ut=function(){return a},ut()}function ft(a,e){var t=ut();return ft=function(n,s){n=n-469;var x=t[n];return x},ft(a,e)}class w{constructor(e){var t=ft;this[t(475)]=e}}const J=et;(function(a,e){const t=et,n=a();for(;[];)try{if(-parseInt(t(485))/1*(parseInt(t(462))/2)+-parseInt(t(477))/3+parseInt(t(464))/4+parseInt(t(486))/5*(-parseInt(t(469))/6)+-parseInt(t(471))/7*(-parseInt(t(484))/8)+parseInt(t(479))/9*(parseInt(t(483))/10)+-parseInt(t(475))/11===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(pt,794284);class ie extends l.Node{constructor(e,t){const n=et;super(),this.nodeCtrlBox=e,this.editor=e.editor,this.stage=this.editor.stage,this.selectedGroup=this.stage[n(472)],this.resizeTo(p.nodeResizePoint[n(467)],p.nodeResizePoint.height),this.css(p.nodeResizePoint[n(480)]),this.name=t}mouseenterHandler(){}[J(465)](){const e=J;let t,n=this.name;n==l.Position.lt?t=e(468):n==l.Position.ct?t="n-resize":n==l.Position.rt?t=e(460):n==l.Position.lm?t="w-resize":n==l.Position.rm?t="e-resize":n==l.Position.lb?t=e(476):n==l.Position.cb?t=e(470):n==l.Position.rb&&(t="se-resize"),this.editor.stage.setCursor(t)}[J(481)](e){}mousedownHandler(e){e.preventDefault()}mouseupHandler(e){e.preventDefault()}[J(482)](e){const t=J;let n=this.nodeCtrlBox,s=n.editor,x=s.stage,i=this.name;if(this.selectedGroup[t(466)]()[t(478)]==0)throw new Error("selectedGroup.length is 0!");let c=x.inputSystem[t(458)],h=c.stageToLocalXY(e.x,e.y),d=c[t(474)](i),u=h.x-d.x,f=h.y-d.y;if(i==l.Position.lt?(u=-u,f=-f):i==l.Position.ct?(u=0,f=-f):i==l.Position.rt?f=-f:i==l.Position.lm?(u=-u,f=0):i==l.Position.rm?f=0:i==l.Position.lb?u=-u:i==l.Position.cb?u=0:i==l.Position.rb,s[t(473)].isKeydown(ht.ResizeKeepAspectRatio)){let b=c.height/(c.width||1);f=u*b}if(this.adjustFixedDirection(c,{dx:u,dy:f},i),u!=0&&f!=0){let b=new w("resize");b.object=c,b.details={dx:u,dy:f,ctrl:i},s[t(463)](b)}}adjustFixedDirection(e,t,n){const s=J;let x=l.PositionInvertMap[n],i=e.positionToLocalPoint(x);i=e[s(461)](i),e[s(459)](t.dx,t.dy);let r=e[s(474)](x);r=e.transformPoint(r);let o=i.x-r.x,c=i.y-r.y;e.translateWith(o,c),this.nodeCtrlBox.updateSize()}}function et(a,e){const t=pt();return et=function(n,s){return n=n-458,t[n]},et(a,e)}function pt(){const a=["ne-resize","transformPoint","498626fWpTTi","dispatchEvent","2228592EXbqUT","mousemoveHandler","getNoChildrensObjects","width","nw-resize","3312678LfUDjM","s-resize","7koELFD","selectedGroup","keyboard","positionToLocalPoint","9064308TpVIOF","sw-resize","1261545VMYmbu","length","161199kfizhq","style","mouseoutHandler","dragHandler","670oBmKEX","10659048zYDkSA","2lyCLSW","5DwnvWi","target","resizeWith"];return pt=function(){return a},pt()}function X(a,e){const t=_t();return X=function(n,s){return n=n-213,t[n]},X(a,e)}const Y=X;(function(a,e){const t=X,n=a();for(;[];)try{if(parseInt(t(223))/1*(parseInt(t(238))/2)+-parseInt(t(221))/3+parseInt(t(232))/4+parseInt(t(228))/5*(parseInt(t(234))/6)+-parseInt(t(222))/7*(-parseInt(t(225))/8)+parseInt(t(215))/9+-parseInt(t(214))/10===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(_t,610538);function $t(a,e){const t=X;let n=e.inputSystem,s=a[t(239)]("center");return s=a.getStageTransform().point(s),Math[t(240)](n.y-s.y,n.x-s.x)}function _t(){const a=["mouseInitAngle","342668EzoNnL","positionToLocalPoint","atan2","preventDefault","editor","19847400fUgGbD","370152eCXYEk","object","style","setCursor","mouseupHandler","details","1766592JatDBX","2072DuWOSk","1EzuhvD","resizeTo","20672uWHyex","auto","width","1984120imDwNn","nodeRotatePoint","target","selectedGroup","4065376BmJJmc","mousemoveHandler","18sjNSQG","stage","elementInitAngle"];return _t=function(){return a},_t()}class ae extends l.CircleNode{constructor(e,t){const n=X;super(),this[n(213)]=e[n(213)],this[n(235)]=this.editor.stage,this[n(231)]=this.stage.selectedGroup,this.css(p[n(229)][n(217)]),this[n(224)](p[n(229)][n(227)],p[n(229)].height),this.name=t}[Y(233)](){this[Y(235)].setCursor(l.Cursor.move)}mousedownHandler(e){const t=Y;e.preventDefault();let n=this.stage;if(this.selectedGroup.getNoChildrensObjects().length==0)throw new Error("selectedGroup.length is 0!");let x=n.inputSystem.target;this.elementInitAngle=x.rotation,this[t(237)]=$t(x,n)}[Y(219)](e){const t=Y;this.stage[t(218)](t(226)),e[t(241)]()}dragHandler(e){const t=Y;e.preventDefault();let n=this.parent,s=n.editor,x=s.stage;if(s.stage.selectedGroup.getNoChildrensObjects().length==0)throw new Error("selectedGroup.length is 0!");let o=x.inputSystem[t(230)],c=$t(o,x)-this.mouseInitAngle;if(o.rotate(this[t(236)]+c),n.updateSize(),c!=0){let h=new w("rotate");h[t(216)]=o,h[t(220)]={dAngle:c},s.dispatchEvent(h)}}}function bt(){const a=["viewClone","center","594TgGuaM","3235188DHrGoI","rotate","12822072WsEKBe","forEach","createCtrlPoint","updateSize","currNode","132GrQEfP","rotateLineLength","show","initCtrlPoint","editor","346668ZWscCy","4RlPNah","7iryMDC","1290996jAdPzC","beginArrow","hide","282418lOLraI","resizeTo","visible","nodeRotatePoint","attachTo","45bKEDuG","isSelected","51845jJMbWx","translateTo","initPoints","1752610XaGhbQ","positionToLocalPoint"];return bt=function(){return a},bt()}const N=D;(function(a,e){const t=D,n=a();for(;[];)try{if(-parseInt(t(404))/1+-parseInt(t(401))/2+-parseInt(t(419))/3*(-parseInt(t(399))/4)+parseInt(t(411))/5*(-parseInt(t(393))/6)+parseInt(t(400))/7*(parseInt(t(388))/8)+-parseInt(t(409))/9*(-parseInt(t(414))/10)+-parseInt(t(418))/11*(parseInt(t(398))/12)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(bt,841420);function D(a,e){const t=bt();return D=function(n,s){return n=n-388,t[n]},D(a,e)}function re(a){const e=D;let t=a.parent;return t instanceof l.Link&&(t[e(402)]===a||t.endArrow===a)}class oe extends l.Node{constructor(e,t=0,n=0,s=1,x=1){const i=D;super(null,t,n,s,x),this.zIndex=l.DefaultZIndexs.NodeCtrlBox,this[i(397)]=e,this.mouseEnabled=![],this[i(403)]()}update(){const e=D;this[e(406)]&&this[e(391)]()}mouseoutStageHandler(){}mouseenterStageHandler(){}[N(396)](e){const t=N;this.removeAllChild();let n=e.getCtrlPoints(),s=this;n[t(389)](x=>{const i=t;if(s[i(390)](x),x==i(420)){let r=function(){return s[i(415)](l.Position.ct)},o=s.createCtrlPoint(i(420)),c=new l.Link(null,o,r);c.css(p[i(407)].rotateLineStyle),c.mouseEnabled=![],s.addChild(c)}})}createCtrlPoint(e){let t;return e=="rotate"?t=new ae(this,e):t=new ie(this,e),this.addChild(t),t}clearTarget(){const e=N;this[e(392)]=null,this.hide()}[N(408)](e){const t=N;if(!re(e)){if(e.editable!=!![])throw new Error("attach not Node or not editable");this.currNode!==null&&this.initCtrlPoint(e),this.currNode=e,this.updateSize(),this[t(395)]()}}updateSize(){const e=N;let t=this.currNode;if(t==null||t[e(410)]==![]||t.parent==null){this.currNode=null,this.hide();return}this[e(416)](t),this[e(413)]()}initPoints(){const e=N;let t=this.getChildren();for(var n=0;n<t.length;n++){let s=t[n];if(s instanceof l.Link)continue;let x;s.name==e(420)?(x=this.positionToLocalPoint(l.Position.ct),x.y-=p.nodeRotatePoint[e(394)]):x=this.positionToLocalPoint(s.name),s instanceof l.Node&&s[e(412)](x.x,x.y)}}viewClone(e){const t=N;let n=e.getStageTransform(),s=n.point(e.positionToLocalPoint(l.Position.center)),x=n.point(e[t(415)](l.Position.rm)),i=Math.atan2(x.y-s.y,x.x-s.x);n.rotate(-i);let r=n.point(e[t(415)](l.Position[t(417)])),o=n.point(e[t(415)](l.Position.rb)),c=(o.x-r.x)*2,h=(o.y-r.y)*2;this[t(405)](c,h),this.rotate(i),this.translateTo(s.x,s.y)}}const A=U;(function(a,e){const t=U,n=a();for(;[];)try{if(parseInt(t(460))/1*(-parseInt(t(459))/2)+-parseInt(t(447))/3+parseInt(t(442))/4*(parseInt(t(424))/5)+parseInt(t(419))/6+parseInt(t(417))/7+-parseInt(t(450))/8*(-parseInt(t(456))/9)+-parseInt(t(452))/10===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(gt,259761);function gt(){const a=["anchorBox","crosshair","target","isActive","1386584NIvylz","inputSystem","canConnectEndpoint","points","fold1","122733grPpbm","unActive","s_resize","24DYdxFL","linkCtrlBox","6110950obypRD","parent","e_resize","dragHandler","341523fCeNQG","ctrlPoint2","setCursor","39536yRoSPL","6VxUzTG","findConnectableEndpoint","ctrlPoint","2756628lCEcBP","name","1056504zJonzP","upgradeParent","ctrlPoint1","mousedownHandler","setCtrlPoint1","5hOOHHD","stage","setBegin","event","end","attachedLink","updateMatrix","positionToLocalPoint","hide","setCenterOffset","fold2","editor","setCtrlPoint","begin"];return gt=function(){return a},gt()}function U(a,e){const t=gt();return U=function(n,s){return n=n-417,t[n]},U(a,e)}class ce extends l.CircleNode{constructor(e){const t=U;super(),this.isConnectPoint=!![],this.isActive=![],this.setRadius(p.linkCtrlPoint.size),this.linkCtrlBox=e,this.editor=this[t(451)].editor,this.css(p.linkCtrlPoint.style)}active(){const e=U;this.css(p.linkCtrlPoint.activeStyle),this[e(441)]=!![]}[A(448)](){this.css(p.linkCtrlPoint.unactiveStyle),this.isActive=![]}mousemoveHandler(){const e=A;this.editor.anchorBox[e(432)](),this.editor.stage.setCursor(l.Cursor.move);let t=this[e(453)],n=this.editor.stage,s=t.attachedLink;if(s instanceof l.AutoFoldLink){let x=null,i=s[e(445)][0],r=s.points[1],o=s.points[4],c=s.points[5];this[e(418)]==l.Position.fold1?l.isHorizontal(s.getK(0,.5))?x=r.x>i.x?l.Cursor.w_resize:l.Cursor[e(454)]:x=r.y>i.y?l.Cursor.s_resize:l.Cursor.n_resize:this.name==l.Position[e(434)]?l.isHorizontal(s.getK(4,.5))?x=o.x>c.x?l.Cursor.w_resize:l.Cursor.e_resize:x=o.y>c.y?l.Cursor[e(449)]:l.Cursor.n_resize:this.name==l.Position.center&&(l.isHorizontal(s.getK(2,.5))?x=l.Cursor.s_resize:x=l.Cursor[e(454)]),x&&n.setCursor(x)}}[A(422)](e){const t=A;this.editor[t(425)].setCursor("crosshair"),this[t(444)]=null}[A(455)](e){const t=A;let n=this[t(453)],s=n.parent,x=s.stage;const i=this[t(435)];let r=n[t(429)];i.anchorBox[t(432)]();const o=this.name;this.editor[t(425)].setCursor(l.Cursor[t(439)]);let c=r[t(453)].stageToLocalXY(x.inputSystem.x,x[t(443)].y);if(e.isDragStart&&(o===l.Position.begin||o===l.Position.end)&&this.active(),o==l.Position.begin){r instanceof l.AutoFoldLink&&r.resetOffset(),r.setBegin({x:c.x,y:c.y}),r.updateMatrix(),this[t(444)]=i.anchorBox[t(461)]([r]);return}if(o==l.Position[t(428)]){r instanceof l.AutoFoldLink&&r.resetOffset(),r.setEnd({x:c.x,y:c.y}),r.updateMatrix(),this.canConnectEndpoint=i[t(438)][t(461)]([r]);return}if(r instanceof l.CurveLink)this[t(418)]==l.Position.ctrlPoint&&(r.ctrlPoint==null?r[t(436)](r.positionToLocalPoint(o)):(r.ctrlPoint.x+=c.x-r[t(462)].x,r.ctrlPoint.y+=c.y-r.ctrlPoint.y,r[t(436)](r.ctrlPoint)));else if(r instanceof l.BezierLink)o==l.Position[t(421)]?r[t(421)]==null?r[t(423)](r.positionToLocalPoint(o)):(r.ctrlPoint1.x+=c.x-r.ctrlPoint1.x,r.ctrlPoint1.y+=c.y-r.ctrlPoint1.y,r.setCtrlPoint1(r.ctrlPoint1)):o==l.Position[t(457)]&&(r[t(457)]==null?r.setCtrlPoint2(r.positionToLocalPoint(o)):(r.ctrlPoint2.x+=c.x-r.ctrlPoint2.x,r[t(457)].y+=c.y-r.ctrlPoint2.y,r.setCtrlPoint2(r[t(457)])));else if(r instanceof l.AutoFoldLink){if(o==l.Position.fold1){let h=r[t(431)](l.Position[t(446)]);const d=c.x-h.x,u=c.y-h.y;r.setFold1Offset(d,u),r.updateMatrix()}else if(o==l.Position.center){let h=r[t(431)](l.Position.center);const d=c.x-h.x,u=c.y-h.y;r[t(433)](d,u),r.updateMatrix()}else if(o==l.Position.fold2){let h=r[t(431)](l.Position.fold2);const d=c.x-h.x,u=c.y-h.y;r.setFold2Offset(d,u),r[t(430)]()}}}mouseupHandler(e){const t=A;this.editor.stage[t(458)](l.Cursor.auto),e[t(427)].preventDefault(),this.isActive&&this.unActive();let n=this.parent,s=n.attachedLink;if(this.canConnectEndpoint!=null){let x=this[t(444)],i=x[t(440)];if(i.isLink){let r=i;r.end.target!==s&&r.begin[t(440)]!==s&&(this[t(418)]==l.Position.begin?s[t(426)](r,x):this.name==l.Position.end&&s.setEnd(r,x),s[t(420)](),s.updateMatrix())}else this.name==l.Position[t(437)]?s.setBegin(i,x):this.name==l.Position[t(428)]&&s.setEnd(i,x),s.upgradeParent(),s.updateMatrix();this.canConnectEndpoint=null}}}const H=nt;(function(a,e){const t=nt,n=a();for(;[];)try{if(parseInt(t(293))/1+-parseInt(t(301))/2+-parseInt(t(300))/3+parseInt(t(307))/4*(parseInt(t(312))/5)+-parseInt(t(305))/6+parseInt(t(292))/7*(-parseInt(t(323))/8)+parseInt(t(304))/9*(parseInt(t(298))/10)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(yt,232920);function nt(a,e){const t=yt();return nt=function(n,s){return n=n-291,t[n]},nt(a,e)}function yt(){const a=["attachedLink","updateCtrlPoints","ctrlLinkStyle","parent","addChild","begin","getCtrlPoints","ctrlPointInfo","Link","end","158088PEHdSB","linkCtrlPoint","hideAllPoint","mouseenterStageHandler","28REBzer","309138iIXbcq","init","inputSystem","isConnectPoint","setBegin","10JHJIpp","name","920037TYpnYw","799368kKAeNm","LinkCtrlBox","css","7096752knSrwV","522750OLDJUc","anchorNameStr","136jmCCJQ","removeAllChild","updateFllow","show","join","1145GvSiQw"];return yt=function(){return a},yt()}class le extends l.Node{constructor(e){const t=nt;super(),this[t(320)]={},this.zIndex=l.DefaultZIndexs[t(302)],this.editor=e,this.ctrlPointStyle=new l.Style({}),this[t(294)]()}mouseoutStageHandler(){}[H(291)](){}createNodeResizePoint(e){const t=H;let n=new ce(this);return n[t(299)]=e,this[t(317)](n),n}init(){const e=H;this[e(320)]={},this.hide()}draw(e){this.visible!=![]&&this.updateSize()}updateSize(){const e=H,t=this.editor.stage[e(295)].target;this.attachedLink?this.attachedLink[e(316)]==null||t==null||this[e(313)]!=t?(this.attachedLink=null,this.hide()):this.attachTo(this.attachedLink):this.hide()}updateCtrlPoints(e){const t=H;this.attachedLink=e;let n=e[t(319)]();this.anchorNameStr=n[t(311)](",");for(let s=0;s<n.length;s++){let x=n[s],i=this.ctrlPointInfo[x];if(i==null){if(i=this.createNodeResizePoint(x),x!=l.Position.begin&&x!=l.Position.end&&(i.fillColor=this.ctrlPointStyle.background,i[t(303)](p[t(324)].adjustStyle),i[t(296)]=![]),x=="ctrlPoint1"){let r=new l.Link;r[t(303)](p.linkCtrlPoint.ctrlLinkStyle),r.setBegin(i,"center");let o=this[t(320)][t(318)];r.setEnd(o,"center"),this.addChild(r),this.ctrlPointInfo[x+t(321)]=r}else if(x=="ctrlPoint2"){let r=new l.Link;r.css(p.linkCtrlPoint[t(315)]),r[t(297)](i,"center");let o=this[t(320)][t(322)];r.setEnd(o,"center"),this.addChild(r),this[t(320)][x+t(321)]=r}else if(x=="ctrlPoint"){let r=new l.Link;r[t(303)](p.linkCtrlPoint.ctrlLinkStyle),r[t(297)](i,"center");let o=this.ctrlPointInfo[t(318)];r.setEnd(o,"center"),this.addChild(r),this[t(320)][x+"Link"]=r}this[t(320)][x]=i}}}[H(325)](){let e=this.ctrlPointInfo;for(var t in e)e[t].hide()}updateFllow(){const e=H,t=this.attachedLink;let n=t.getStageTransform(),s=t.getCtrlPoints();this.hideAllPoint();for(let x=0;x<s.length;x++){const i=s[x];let r=this.ctrlPointInfo[i];if(r==null)continue;let o=t.positionToLocalPoint(i),c=n.point(o);r.translateTo(c.x,c.y),r[e(310)]();let h=this[e(320)][i+e(321)];h&&h.show()}}attachTo(e){const t=H;if(this.matrixDirty=!![],e.parent!=null){if(this.attachedLink===e){e instanceof l.AutoFoldLink&&e.getCtrlPoints().join(",")!=this[t(306)]&&this.updateCtrlPoints(e),this.updateFllow(),this[t(310)]();return}this.ctrlPointInfo={},this.removeAllChild(),this[t(314)](e),this[t(309)](),this[t(310)]()}}clearTarget(){const e=H;this.attachedLink=null,this.ctrlPointInfo={},this[e(308)](),this.hide()}}const g=mt;(function(a,e){const t=mt,n=a();for(;[];)try{if(parseInt(t(135))/1+parseInt(t(109))/2*(parseInt(t(134))/3)+parseInt(t(133))/4*(-parseInt(t(107))/5)+-parseInt(t(117))/6*(-parseInt(t(112))/7)+-parseInt(t(108))/8+parseInt(t(123))/9+parseInt(t(127))/10===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(It,785784);function It(){const a=["drawStartInfo","findConnectableEndpoint","mouseenterHandler","isIntersectPoint","isActive","unactive","setIntersect","defineProperty","setCursor","mousemoveHandler","7045ITwrAr","9376432wutwPB","8RAwxyi","stage","size","4407067lusBsQ","mouseoutHandler","isDragStart","Circle","show","6yCWPUH","lineDrawingFinished","active","link","instanceManager","end","4777920gsravc","getOwnPropertyDescriptor","target","prototype","7119800XxnWET","shape","record","upgradeParent","anchorPoint","inputSystem","1092OeFaQv","295719cmYVWV","75762HUBojl","editor","crosshair"];return It=function(){return a},It()}var de=Object[g(104)],he=Object[g(124)],te=(a,e,t,n)=>{for(var s=n>1?void 0:n?he(e,t):e,x=a.length-1,i;x>=0;x--)(i=a[x])&&(s=(n?i(e,t,s):i(s))||s);return n&&s&&de(e,t,s),s};function mt(a,e){const t=It();return mt=function(n,s){return n=n-104,t[n]},mt(a,e)}const ue="intersectNode";class st extends l.Node{constructor(e,t=0,n=0,s=1,x=1){const i=g;super(null,t,n,s,x),this[i(142)]=![],this.isIntersectPoint=![],this.anchorBox=e,this[i(136)]=e[i(136)],this[i(110)]=this.editor.stage,this.resizeTo(p.anchorPoint[i(111)],p[i(131)].size),this.css(p[i(131)].style),this[i(143)]()}[g(144)](e){this.intersect=e}[g(140)](){this[g(119)]()}[g(113)](){const e=g;this.stage.setCursor("auto"),this[e(143)]()}[g(106)](){}mousedownHandler(e){const t=g;e.preventDefault(),this.editor[t(110)].setCursor(t(137)),this.link=null}dragHandler(e){const t=g;if(e.buttons==2)return;const n=this[t(136)],s=n.stage;this.anchorBox.activedPoint&&this.anchorBox.activedPoint[t(143)]();const x=this.anchorBox[t(125)];if(e[t(114)]){let i;if(this[t(141)]){let r=this.anchorBox.intersect;i=new l.EndpointSegment(x,r.rate,r.segIndex)}else i=new l.EndpointFixedName(x,this.name);this.drawStartInfo={x:e.x,y:e.y,beginEndpoint:i,timeStamp:Date.now()};return}if(this[t(138)]!=null){let i=l.Point.distancePoint(this[t(138)],e);if(Date.now()-this.drawStartInfo.timeStamp>p.anchorPoint.drawStartDelay&&i>p[t(131)].drawStartMinDistance){this[t(136)].showTip("画线开始"),console.assert(this.link==null,this.link),this.editor[t(129)]("划线");const c=n.instanceManager.lineDrawn(null,x,null,this.drawStartInfo.beginEndpoint);this[t(120)]=c;let h=c.parent.stageToLocalXY(s.inputSystem.x,s.inputSystem.y);c.setEnd(h),this.drawStartInfo=null}}if(this.link!=null&&this[t(120)].end!=null){let i=this.link.parent.stageToLocalXY(s.inputSystem.x,s[t(132)].y);this[t(120)].setEnd(i),this.endpoint=this.anchorBox.findConnectableEndpoint([this[t(120)],this.link[t(122)][t(125)]])}}mouseupHandler(e){const t=g;this[t(116)](),this.editor.update(),this.editor.stage[t(105)]("auto"),this.link!=null&&(this.endpoint&&(this[t(120)].setEnd(this.endpoint),this.link[t(130)](),this.link.updateMatrix()),this.editor[t(121)][t(118)](this[t(120)]),this.anchorBox[t(139)]([]),this[t(136)].recordEnd("划线")),this.link=null}active(){const e=g;this[e(142)]=!![],this.css(p.anchorPoint.activeStyle)}[g(143)](){const e=g;this.isActive=![],this.css(p[e(131)].unActiveStyle)}}te([l.setProto(l.Shape[g(115)])],st.prototype,"shape",2),te([l.setProto(g(128))],st[g(126)],"pickType",2);function q(a,e){const t=Ct();return q=function(n,s){return n=n-280,t[n]},q(a,e)}const I=q;function Ct(){const a=["getObjectsIntersect","15807624DMdgTO","1706986PwqdGz","update","getConnectableEndpointFromObjects","anchorBox","_obb","name","forEach","connectable","getCenter","editor","activeStyle","canConnectable","anchorPoint","active","clearTarget","setTarget","nodeDist","_findChildren","children","index","30eAoxIw","5032017xCSYpl","createAnchorPoint","1497875fClIzK","1597200mZmVKy","target","length","object","translateTo","stage","displayList","ctrlIntersectPoint","activeNameOrPoint is null","addChild","aabb","2291737JSrkus","showIntersectAnchor","hide","getLocalPoint","1835900jFwrks","activePointByName"];return Ct=function(){return a},Ct()}(function(a,e){const t=q,n=a();for(;[];)try{if(-parseInt(t(311))/1+parseInt(t(307))/2+-parseInt(t(289))/3+-parseInt(t(292))/4+parseInt(t(291))/5*(parseInt(t(288))/6)+parseInt(t(303))/7+parseInt(t(310))/8===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Ct,935544);function fe(a){let e=a.parent;return e instanceof l.Link&&(e.beginArrow===a||e.endArrow===a)}class pe extends l.Node{constructor(e,t=0,n=0,s=1,x=1){const i=q;super(null,t,n,s,x),this.editor=e,this[i(299)]=this[i(290)](ue),this[i(299)].isIntersectPoint=!![],this.ctrlIntersectPoint.hide()}cancel(){}mouseoutStageHandler(){}mouseenterStageHandler(){}clearTarget(){const e=q;this[e(293)]=null,this[e(305)]()}[I(283)](e){const t=I;if(!this.canConnectable(e))return;if(this.target!==e){if(this.target=e,e!=null&&(e instanceof l.Node||e instanceof l.Link)){let x=e.getAnchorPoints();this[t(286)][t(294)]=0;for(var n=0;n<x[t(294)];n++){let i=x[n];this.createAnchorPoint(i)}}this[t(312)]()}this.children[t(317)](x=>x.unactive()),this.ctrlIntersectPoint.hide(),this.show()}[I(322)](e){const t=I;return e==null||fe(e)?![]:e.visible&&e.mouseEnabled&&e[t(318)]&&e.painted}setTargetWithName(e,t){const n=I;if(t==null)throw new Error(n(300));this.setTarget(e),this[n(308)](t),this.show()}clearActived(){this.activedPoint&&this.activedPoint.unactive(),this.ctrlIntersectPoint.hide()}activePointByName(e){const t=I;this.activedPoint&&this.activedPoint.unactive();let n=this.children,s=n.filter(x=>x[t(316)]==e)[0];this.activedPoint=s,s[t(281)](),this.ctrlIntersectPoint.hide()}[I(304)](e){const t=I;if(this.intersect=e,e==null){this.ctrlIntersectPoint.hide();return}let n=e.rate,s=e.segIndex;const x=this.target;let i=x[t(306)](n,s),o=x.getStageTransform().point(i);this.ctrlIntersectPoint.translateTo(o.x,o.y),this[t(299)].css(p[t(280)][t(321)]),this.ctrlIntersectPoint.show()}update(){const e=I;if(this.target==null||this.target.parent==null){this[e(282)]();return}const t=this[e(293)],n=t.getStageTransform(),s=this.children;for(let x=0;x<s[e(294)];x++){const i=s[x],r=i.name;if(!i.isIntersectPoint){let o=t.positionToLocalPoint(r),c=n.point(o);i[e(296)](c.x,c.y)}}}createAnchorPoint(e){const t=I,n=new st(this);return n[t(316)]=e,n[t(314)]=this,this[t(301)](n),n}[I(309)](e){const t=I;let n=this[t(320)].stage,s=this.editor.getCurrentLayer(),x={x:n.inputSystem.x,y:n.inputSystem.y};return l.getNearestPointOnObjectsOBB(s,x,e,p.anchorBox[t(284)])}getConnectableEndpointFromObjects(e){const t=I,n=this.editor,s=this,x=n[t(297)],i=x.inputSystem,r={x:i.x,y:i.y},o=l.getNearestAnchorOnObjects(r,e,p.anchorPoint.size/2),c=n.keyboard.isControlDown();if(o.length==0&&!c){let d=_e(x,100);return this.canConnectable(d)&&s.setTarget(d),null}if(o.length>0){o.sort((S,P)=>{const C=t;let k=S.object,m=P[C(295)];if(c){let Be=k instanceof l.Link?0:1,je=m instanceof l.Link?0:1;return Be-je}let M=k instanceof l.Node?0:1,Oe=m instanceof l.Node?0:1;return M-Oe});const d=o[0],u=d[t(295)];let f=d.anchorName;const b=new l.EndpointFixedName(u,f);return s.setTargetWithName(u,f),b}const h=this[t(309)](e);if(h!=null){const d=h.object;s.setTarget(d);const u=new l.EndpointSegment(d,h.rate,h.segIndex);return this.showIntersectAnchor(h),u}return s[t(282)](),null}findConnectableEndpoint(e){const t=I,n=this.editor,s=this,x=n[t(297)].localView.getObject();function i(c){const h=t;return e.indexOf(c)==-1&&s[h(322)](c)}const r=x[t(285)](null,i,!![]);return this[t(313)](r)}}function _e(a,e){const t=I,n=a.getCurrentLayer(),s={x:n.mouseX,y:n.mouseY};let x=n[t(298)].filter(o=>o.isNode),i=x.map((o,c)=>{const h=t;let d=o[h(315)][h(302)][h(319)]();return{index:c,dist:l.Point.distancePoint(s,d)}});if(i=i.filter(o=>o.dist<=e),i.length==0)return null;i.sort((o,c)=>o.dist-c.dist);let r=i[0][t(287)];return x[r]}const E=Q;(function(a,e){const t=Q,n=a();for(;[];)try{if(parseInt(t(192))/1*(parseInt(t(190))/2)+parseInt(t(182))/3+parseInt(t(191))/4+-parseInt(t(186))/5*(parseInt(t(175))/6)+parseInt(t(183))/7*(-parseInt(t(181))/8)+-parseInt(t(179))/9*(-parseInt(t(176))/10)+parseInt(t(185))/11*(-parseInt(t(188))/12)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(wt,716337);function Q(a,e){const t=wt();return Q=function(n,s){return n=n-168,t[n]},Q(a,e)}const be={cut:E(173),copy:"copy",delete:"删除",modify:"修改",addChild:"添加图元",pasteCopy:"辅助粘贴",pasteCut:"剪切粘贴",resize:"尺寸修改",rotate:"旋转",dragNodeOrLink:"位置改变",modifyLink:"连线调整"};class ge{constructor(e,t,n){const s=E;this.type=e,this[s(170)]=n,this.redoFn=t}redo(){this[E(172)]()}undo(){this[E(170)]()}}class ye extends EventTarget{constructor(e){const t=E;super(),this[t(171)]=e,this.undoHistory=[],this.redoHistory=[]}[E(174)](){const e=E;this.undoHistory=[],this[e(177)]=[]}push(e,t,n){const s=E;let x=new ge(e,t,n);return x[s(171)]=this.editor,this.redoHistory[s(189)]=0,this.undoHistory[s(187)](x),x}undo(){const e=E;if(this.undoHistory.length==0)return null;let t=this.undoHistory[e(168)]();return t.undo(),this.redoHistory[e(187)](t),t}redo(){const e=E;if(this.redoHistory.length==0)return null;let t=this.redoHistory.pop();return t.redo(),this[e(169)].push(t),t}undoAll(e=500){let t=this;function n(){const s=Q;let x=t[s(184)]();t.editor[s(178)](),x!=null&&setTimeout(n,e)}n()}redoAll(e=500){let t=this;function n(){const s=Q;t.editor.update(),t[s(180)]()!=null&&setTimeout(n,e)}n()}}function wt(){const a=["undo","480964bFijEs","47865lmKess","push","384sUfcMn","length","4kpzLoq","1722848UKCoaG","44449bXRYlp","pop","undoHistory","undoFn","editor","redoFn","cut","clear","126eJJtcM","299590dOtufR","redoHistory","update","405VqAfES","redo","80RyxmKg","3485829bUSEgt","499219RkZgis"];return wt=function(){return a},wt()}(function(a,e){const t=xt,n=a();for(;[];)try{if(parseInt(t(306))/1*(-parseInt(t(302))/2)+parseInt(t(309))/3*(-parseInt(t(308))/4)+-parseInt(t(298))/5*(parseInt(t(303))/6)+-parseInt(t(299))/7+-parseInt(t(310))/8*(parseInt(t(304))/9)+-parseInt(t(301))/10*(parseInt(t(300))/11)+parseInt(t(305))/12===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Pt,789525);const Ie={getItem:function(a){const e=xt;return localStorage[e(307)](a)},setItem:function(a,e){localStorage.setItem(a,e)},saveWithVersion(a,e){a+=Date.now(),this.setItem(a,e)},getAllVersions(a){const e=xt;return Object.keys(localStorage).filter(n=>n[e(311)](a))[e(297)]()},getLastVersion(a,e){let t=this.getAllVersions(a).reverse();if(t.length==0)return;e==null&&(e=0),e+1>=t.length&&(e=t.length-1);let n=t[e];return this.getItem(n)}};function Pt(){const a=["192056vkmXct","startsWith","sort","3340730oOretE","9030805rPCYzF","11ObfWWh","10477420CcOKrm","2vrffXd","6loAsYO","531JSGNDv","69271548SSiJXD","53381HiYsid","getItem","148ODRwth","41133NkmPhY"];return Pt=function(){return a},Pt()}function xt(a,e){const t=Pt();return xt=function(n,s){return n=n-297,t[n]},xt(a,e)}(function(a,e){const t=Lt,n=a();for(;[];)try{if(-parseInt(t(279))/1*(parseInt(t(286))/2)+-parseInt(t(295))/3+parseInt(t(291))/4*(-parseInt(t(282))/5)+parseInt(t(283))/6+parseInt(t(293))/7*(-parseInt(t(288))/8)+-parseInt(t(289))/9+-parseInt(t(292))/10*(-parseInt(t(285))/11)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(vt,643470);function Lt(a,e){const t=vt();return Lt=function(n,s){return n=n-279,t[n]},Lt(a,e)}function me(a,e,t){const n=Lt,s=a[n(294)],x=a.KeysConfig.CreateGroup;let i={};function r(h){const d=n;i[h]=a.stage[d(280)].objects[d(290)](),a.showOpTooltip("编组-"+h)}function o(h){const d=n;let u=i[h];if(u)return u=u.filter(f=>f.parent!==null),u.length>0&&(a.showOpTooltip("选编组-"+h),a.stage[d(280)].removeAll().addAll(u),a.stage[d(281)].target=u[0]),u}function c(h){o(h)&&t.centerBy(e.selectedGroup.objects)}for(let h=0;h<=9;h++)s[n(287)](x+"+"+h,function(d){d.preventDefault(),r(h)}),s.bindKey(""+h,function(d){d[n(284)](),o(h)}),s.bindKey(""+h+"+"+h,function(d){d.preventDefault(),c(h)})}function vt(){const a=["bindKey","269600xuHvZj","6020820EGhIYw","slice","1912wuGsVF","10RvurJJ","161QEYeOL","keyboard","811197LCrpfL","1517uKsylx","selectedGroup","inputSystem","4415yGDEIu","2676444lVxdsd","preventDefault","26340919HRkOXC","80QiosLw"];return vt=function(){return a},vt()}(function(a,e){const t=St,n=a();for(;[];)try{if(parseInt(t(494))/1+-parseInt(t(498))/2*(-parseInt(t(482))/3)+-parseInt(t(491))/4+-parseInt(t(497))/5+-parseInt(t(485))/6*(parseInt(t(489))/7)+-parseInt(t(478))/8+parseInt(t(480))/9===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(kt,792549);function St(a,e){const t=kt();return St=function(n,s){return n=n-470,t[n]},St(a,e)}function kt(){const a=["pasteHandler","filter","layoutManager","stylePasteHandler","Move_up","styleCopyHandler","Move_left","2061136aXyJvX","Delete","24672753NmhlgA","editorEventManager","16953TmKeFU","forEach","select","8461158GYYAtC","deleteHandler","Move_down","isNode","7gautCG","redoUndoSys","2437376kYldMd","Copy_style","Cut","443459cEzYHh","getObject","showOpTooltip","5350835qLknvW","338PLLjMj","visible","cutHandler","selectedGroup","getNoChildrensObjects"];return kt=function(){return a},kt()}class Ce{constructor(e){this.editor=e,this.init()}init(){const e=St,t=this.editor,n=t.stage,s=t.currentLayer;let x=t.stage.keyboard;const i=t.KeysConfig;function r(o,c,h){o.forEach(d=>{x.bindKey(d,function(u){c(u)},h)})}x.on("keydown",function(){t.update()}),x.on("keyup",function(o){t.update()}),r(i[e(479)],o=>t[e(481)][e(486)](o)),r(i[e(493)],o=>t.clipboardManager[e(500)](o)),r(i.Copy,o=>{t.showOpTooltip("复制"),t.clipboardManager.copyHandler(o)}),r(i.Paste,o=>t.clipboardManager[e(471)](o)),r(i.Undo,o=>{const c=e;t[c(496)]("撤销"),t[c(490)].undo(),t.clearCtrlBoxs()}),r(i.Redo,o=>{t.showOpTooltip("重做"),t.redoUndoSys.redo(o),t.clearCtrlBoxs()}),r(i.Select_all,o=>{const c=e;t.showOpTooltip("全选");let h=n.localView[c(495)](),d=l.DisplayObject.flatten(h.children,u=>u[c(499)]==!![]);n.select(d)}),r(i.Select_invert,o=>{const c=e;t.showOpTooltip("反选");let h=n.selectedGroup.getNoChildrensObjects();n[c(484)](s.displayList.filter(d=>h.notContains(d)))}),r(i.Save,o=>{t.showOpTooltip("保存"),t.saveHandler(o,t.imageToBase64)},![]),r(i.Open,o=>{t.showOpTooltip("打开"),t.openLasted(o)},![]),r(i.LocalView,o=>{t.toogleLocalView()}),r(i[e(492)],o=>{const c=e;t[c(496)]("复制样式"),t.clipboardManager[c(476)](o)},![]),r(i.paste_Style,o=>{const c=e;t.showOpTooltip("粘贴样式"),t.clipboardManager[c(474)](o)},![]),r(i[e(477)],o=>{const c=e;n.selectedGroup[c(470)]().filter(d=>d.isNode).forEach(d=>{d.x-=1})}),r(i.Move_right,o=>{const c=e;n.selectedGroup.getNoChildrensObjects()[c(472)](d=>d.isNode)[c(483)](d=>{d.x+=1})}),r(i[e(475)],o=>{const c=e;n[c(501)].getNoChildrensObjects()[c(472)](d=>d[c(488)]).forEach(d=>{d.y-=1})}),r(i[e(487)],o=>{const c=e;n.selectedGroup.getNoChildrensObjects().filter(d=>d.isNode)[c(483)](d=>{d.y+=1})}),r(i.Layout_grid,o=>{t[e(473)].doGridLayout()}),me(t,n,s),r(i.Cancel,o=>{t.onEsc(o)})}}function Et(a,e){const t=Tt();return Et=function(n,s){return n=n-133,t[n]},Et(a,e)}const ee=Et;(function(a,e){const t=Et,n=a();for(;[];)try{if(-parseInt(t(140))/1+-parseInt(t(141))/2*(-parseInt(t(153))/3)+-parseInt(t(145))/4*(-parseInt(t(135))/5)+parseInt(t(151))/6*(parseInt(t(133))/7)+parseInt(t(150))/8*(parseInt(t(136))/9)+parseInt(t(146))/10+-parseInt(t(155))/11*(parseInt(t(149))/12)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Tt,768521);let we=ee(142);function Tt(){const a=["6279568VdxxTe","24CNKNps","update","6ScNiBl","align","22dmwHXa","298319xeWDvO","layoutManager","5ntTdVA","9KRTpVw","editorEventManager","select","cutHandler","655794Bgchnj","1192348AuYYiV",`
<div class="header">编辑</div>
<a>剪切</a>
<a>复制</a>
<a>粘贴</a>
<a>删除</a> 
<hr></hr>
<div class="header">前后</div>
<a>上移一层</a>
<a>下移一层</a>
<a>移至顶部</a>
<a>移至底部</a>
<div class="header">对齐</div>
<a>左对齐</a>
<a>右对齐</a>
<a>顶部对齐</a>
<a>底部对齐</a>
<a>水平中心对齐</a>
<a>垂直中心对齐</a>
`,"垂直中心对齐","左右等距","1446804jrGZit","9300160tVuicw","右对齐","zIndex","12090984RCHjmR"];return Tt=function(){return a},Tt()}function Pe(a){const e=ee,t=a.stage;let n=new l.PopupMenu(t,we);return n.addEventListener(e(138),function(s){const x=e,i=s.item;let r=t.inputSystem.target;i=="剪切"?a.clipboardManager[x(139)]():i=="复制"?a.clipboardManager.copyHandler():i=="粘贴"?a.clipboardManager.pasteHandler():i=="删除"&&a[x(137)].deleteHandler(),r!=null&&(i=="上移一层"||i=="下移一层"||i=="移至顶部"?a.layoutManager.setZIndex(r,i):i=="移至底部"?a[x(134)].setZIndex(r,i):i=="左对齐"?a[x(134)][x(154)]("左对齐"):i=="右对齐"?a.layoutManager.align(x(147)):i=="顶部对齐"?a[x(134)].align("顶部对齐"):i=="底部对齐"?a.layoutManager.align("底部对齐"):i=="水平中心对齐"?a.layoutManager.align("水平中心对齐"):i==x(143)?a.layoutManager.align("垂直中心对齐"):i=="左右等距"?a.layoutManager.evenSpacing(x(144)):i=="上下等距"&&a[x(134)].evenSpacing("上下等距"),r[x(148)]<0?r.zIndex=0:r[x(148)]>1e3&&(r[x(148)]=1e3),r.parent!=null&&r.parent.updateZIndex(),a[x(152)]())}),n}const Xt=z;function Ht(){const a=["213487hKBFYz","18053pKAmfB","28uAzifK","75507sIVXxs","css","12ZhFzDf","hideGuidLine","enable","16148924ymkUxB","392778ObTSgk","guildlineW","setBegin","mouseEnabled","322675TqfhtW","show","_disabled","13200HRkNCj","addChild","10rPqEjX","editor","styleS","handlerLayer","2889rDHcOW"];return Ht=function(){return a},Ht()}(function(a,e){const t=z,n=a();for(;[];)try{if(-parseInt(t(263))/1+parseInt(t(268))/2*(parseInt(t(266))/3)+parseInt(t(265))/4*(-parseInt(t(276))/5)+-parseInt(t(272))/6+-parseInt(t(264))/7+-parseInt(t(256))/8*(parseInt(t(262))/9)+-parseInt(t(258))/10*(-parseInt(t(271))/11)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Ht,356174);function z(a,e){const t=Ht();return z=function(n,s){return n=n-254,t[n]},z(a,e)}class Le{constructor(e){const t=z;this[t(255)]=!![],this[t(259)]=e,this.init()}init(){const e=z,t=this[e(259)],n=new l.Link;n[e(275)]=![],n[e(267)](p.guildLine.styleW),n.hide(),this.guildlineW=n,t[e(261)].addChild(this.guildlineW);const s=new l.Link;n.mouseEnabled=![],s.css(p.guildLine[e(260)]),s.hide(),this.guildlineS=s,t.handlerLayer[e(257)](this.guildlineS)}disable(){const e=z;this[e(255)]=!![],this[e(269)]()}[Xt(270)](){this._disabled=![]}showGuildLine(e){const t=Xt;if(this._disabled)return;const n=this.editor,s=n.stage,x=this[t(273)],i=this.guildlineS;x[t(274)]({x:0,y:e.y}),x.setEnd({x:s.width,y:e.y}),x.show(),i.setBegin({x:e.x,y:0}),i.setEnd({x:e.x,y:s.height}),i[t(254)]()}hideGuidLine(){this[Xt(273)].hide(),this.guildlineS.hide()}}function Z(a,e){var t=Mt();return Z=function(n,s){n=n-254;var x=t[n];return x},Z(a,e)}var Yt=Z;(function(a,e){for(var t=Z,n=a();[];)try{var s=parseInt(t(267))/1*(-parseInt(t(269))/2)+-parseInt(t(255))/3+parseInt(t(256))/4*(-parseInt(t(260))/5)+parseInt(t(265))/6+-parseInt(t(259))/7+-parseInt(t(258))/8*(-parseInt(t(264))/9)+-parseInt(t(263))/10*(-parseInt(t(254))/11);if(s===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Mt,428868);function Mt(){var a=["407kigDxh","1347327ooWSwU","12uHReiU","source","552XQIQEW","3725204zLmGrl","602890HIulex","take","takeSource","380630WPJuCJ","9081RRppif","2894868LIZblW","isFirstCutPaste","3aCRhQj","type","125698BXmyGT","cut"];return Mt=function(){return a},Mt()}class Ut{constructor(){this.take=0}copyPut(e){var t=Z;this[t(261)]=0,this.type="copy",this.source=e}cutPut(e){var t=Z;this.take=-1,this[t(268)]=t(270),this[t(257)]=e}[Yt(262)](){return this.take++,this.source}[Yt(266)](){var e=Yt;return this.type==be[e(270)]&&this.take==0}}function Nt(){const a=["record","17285NCRvcF","object","4454072TBPqLR","forEach","cutPut","objects","aabb","nodeCtrlBox","concat","1337574JltjhT","48anRiEM","40jVJsFb","translateWith","cssClipBoard","selectedGroup","654ySvlwo","takeSource","editor","7EeLZKk","target","anchorBox","74626mVnSPw","stage","copyPut","clearTarget","pasteHandler","7978491FCjUHS","4923182rsUPPx","map","recordEnd","5389816sFVBJF"];return Nt=function(){return a},Nt()}function G(a,e){const t=Nt();return G=function(n,s){return n=n-231,t[n]},G(a,e)}const Ot=G;(function(a,e){const t=G,n=a();for(;[];)try{if(-parseInt(t(254))/1+-parseInt(t(234))/2*(parseInt(t(255))/3)+-parseInt(t(247))/4+parseInt(t(245))/5*(parseInt(t(260))/6)+parseInt(t(231))/7*(parseInt(t(243))/8)+parseInt(t(239))/9+parseInt(t(256))/10*(parseInt(t(240))/11)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Nt,679187);class ve{constructor(e){const t=G;this[t(258)]=new Ut,this.clipboard=new Ut,this.cssClipBoard=new Ut,this.editor=e}copyHandler(){const e=G;let t=this[e(262)].stage,n=[][e(253)](t[e(259)].getNoChildrensObjects());if(n.length==0)return;let s=n.map(i=>i.parent);this.clipboard[e(236)]([n,s]);let x=new w("copy");x.object=n,this.editor.dispatchEvent(x)}cutHandler(){const e=G;let t=this[e(262)],n=t[e(235)],s=[].concat(n.selectedGroup.getNoChildrensObjects());if(s.length==0)return;let x=s.map(r=>r.parent);this.clipboard[e(249)]([s,x]),t[e(244)]("剪切"),s.forEach((r,o)=>{x[o].removeChild(r),l.LinkHelper.disconnect(r,s)}),t.recordEnd("剪切"),n.inputSystem[e(232)]=null,t[e(233)].clearTarget(),t[e(252)].clearTarget(),t.linkCtrlBox[e(237)]();let i=new w("cut");i[e(246)]=s,this[e(262)].dispatchEvent(i)}[Ot(238)](){const e=Ot;let t=this[e(262)],n=this.clipboard[e(261)]();if(n==null)return;let s=t.currentLayer,x=t.stage,i=n[0],r=n[1],o=i[e(241)](C=>C._obb[e(251)]),c=l.Rectangle.unionRects(o),h=c.getCenter(),d=s.stageToLocalXY(x.inputSystem.x,x.inputSystem.y),u=d.x-h.x,f=d.y-h.y;t[e(244)]("粘贴");let b=i,S=x.serializerSystem.copyAndToJSON(i);b=x.serializerSystem.jsonToObjects(S),b.forEach((C,k)=>{C[e(257)](u,f)}),b[e(248)]((C,k)=>{r[k].addChild(C)}),t[e(242)]("粘贴");let P=new w("paste");P.object=b,this.editor.dispatchEvent(P)}styleCopyHandler(){const e=Ot;let t=this[e(262)],n=t.stage,s=n.inputSystem.target;s==null&&(!n.selectedGroup.isEmpty()&&(s=n.selectedGroup[e(250)][0]),s==null)||this.cssClipBoard.copyPut(s)}stylePasteHandler(){const e=Ot;let t=this.editor,n=this.cssClipBoard.takeSource();if(n==null)return;let s=t.stage.selectedGroup[e(250)],x=this;t[e(244)]("粘贴样式"),s.forEach(i=>{x.copySetStyle(i,n)}),t[e(242)]("粘贴样式")}copySetStyle(e,t){e!==t&&e.className===t.className&&e.css(t.style)}}function Bt(){const a=["1656920ETMwlI","viewClone","455939WWhSIx","11259280yiwcdj","center","show","point","positionToLocalPoint","attachTo","1734940WAETDo","161634uamVER","91LYFbFQ","zIndex","726135SfVbQc","getStageTransform","visible","1675527ArVdLB","resizeTo"];return Bt=function(){return a},Bt()}function $(a,e){const t=Bt();return $=function(n,s){return n=n-129,t[n]},$(a,e)}const jt=$;(function(a,e){const t=$,n=a();for(;[];)try{if(-parseInt(t(140))/1+parseInt(t(129))/2+parseInt(t(136))/3+parseInt(t(138))/4+parseInt(t(133))/5+parseInt(t(130))/6*(parseInt(t(131))/7)+-parseInt(t(141))/8===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Bt,472294);class Se extends l.Node{constructor(e,t=0,n=0,s=1,x=1){const i=$;super(null,t,n,s,x),this[i(132)]=l.DefaultZIndexs.NodeCtrlBox,this.editor=e,this.css(p.dropBox.style),this.mouseEnabled=![],this.currObject,this.hide()}update(){this[$(135)]&&this.updateSize()}[jt(146)](e){const t=jt;if(e==null||e.editable!=!![]){this.currObject=null,this.hide();return}if(e.isLink)throw new Error("attach not Node");this.currObject=e,this.updateSize(),this[t(143)]()}updateSize(){const e=jt;this.currObject!=null&&this[e(139)](this.currObject)}viewClone(e){const t=jt;let n=e[t(134)](),s=n.point(e[t(145)](l.Position[t(142)])),x=n[t(144)](e.positionToLocalPoint(l.Position.rm)),i=Math.atan2(x.y-s.y,x.x-s.x);n.rotate(-i);let r=n[t(144)](e[t(145)](l.Position[t(142)])),o=n.point(e.positionToLocalPoint(l.Position.rb)),c=(o.x-r.x)*2,h=(o.y-r.y)*2,d=4;this[t(137)](c+d*2,h+d*2),this.rotate(i),this.translateTo(s.x,s.y)}}(function(a,e){const t=it,n=a();for(;[];)try{if(parseInt(t(312))/1*(-parseInt(t(309))/2)+-parseInt(t(307))/3+-parseInt(t(311))/4+-parseInt(t(302))/5*(parseInt(t(310))/6)+parseInt(t(303))/7*(parseInt(t(308))/8)+-parseInt(t(306))/9+-parseInt(t(298))/10*(-parseInt(t(305))/11)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Dt,978119);function it(a,e){const t=Dt();return it=function(n,s){return n=n-298,t[n]},it(a,e)}function ne(a,e){const t=it;let n=a.currentLayer,s=a[t(301)].getAllVisiable().filter(r=>{const o=t;return r.isNode&&r[o(304)]!=!![]&&r.mouseEnabled&&r._cameraVisible}),x=e.filter(r=>r.isOutOfParent()||r.parent===n),i;for(let r=0;r<x.length;r++){let o=x[r];if(i=ke(o,s),i!=null)break}return i==null&&(i=n,x=x.filter(r=>r.parent!==n)),console[t(300)](i.isLink!=!![],!![],i),{parent:i,objects:x}}function Dt(){const a=["25flqjpH","119vboNhi","isSelected","6140453SBHkVD","10725948rKOwli","1312764EISOwM","412656SErWhB","1973414BKRGbi","863364OVHgOy","6348980YUcrqg","1eQSYAw","isIntersectRect","90GCFemV","addChild","assert","currentLayer"];return Dt=function(){return a},Dt()}function ke(a,e){const t=it,n=a.getAABB(),s=e.filter(x=>x===a.parent||x===a?![]:a.isAncestors(x)?![]:!![]);for(let x=s.length-1;x>=0;x--){const i=s[x];if(i.getAABB()[t(313)](n))return i}return null}const y=At;(function(a,e){const t=At,n=a();for(;[];)try{if(-parseInt(t(503))/1+parseInt(t(509))/2*(-parseInt(t(476))/3)+-parseInt(t(508))/4*(-parseInt(t(473))/5)+parseInt(t(493))/6+-parseInt(t(463))/7+-parseInt(t(483))/8*(-parseInt(t(462))/9)+parseInt(t(465))/10*(-parseInt(t(487))/11)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(zt,520361);function At(a,e){const t=zt();return At=function(n,s){return n=n-459,t[n]},At(a,e)}function zt(){const a=["hide","forEach","dragHandler","record","3648690TeyPja","round","setTarget","27690EeCNTA","lineDrawingFinished","setCursor","onLinkCreate","控制点","selectedGroupDragHandler","buttons","7387304VkRjHC","anchorBox","clearTarget","getNoChildrensObjects","11DxqgWq","DropTo_leader","pickUpChild","toStageRect","mouseOverTarget","mousedownHandler","368034IsdTUI","guidlineManager","nodeCtrlBox","getCenter","对象拖拽","delete","dispatchEvent","changeParent","inputSystem","deleteHandler","253066yWLVMj","mouseenterStageHandler","defaultPrevented","parent","popupMenu","4glBDDd","26uTwNGE","mouseupHandler","Shift","charAt","editor","onlineDrawingFinishedHandler","length","modeChange","controlTarget","object","target","linkCtrlBox","mouseoutHandler","Control","attachTo","stage","9eLhCcI","1664558sGyQsG","dropToBox","5832790SfVoay","groupdrag","event","isNode"];return zt=function(){return a},zt()}const Ee=l.ResourceLoader.w!=null?l.ResourceLoader.w[y(512)](3):"1";class Te{constructor(e){const t=y;this[t(513)]=e,this.init()}init(){const e=y;let t=this[e(513)],n=t.stage,s=n.inputSystem,x=t.handlerLayer;n.localView.mode==null&&(n.camera.on("zoom",function(){t.update()}),n.on(l.EventNames[e(516)],function(i){const r=e;let o=i.newMode,c=t.nodeCtrlBox,h=t[r(520)],d=t[r(464)],u=t[r(484)];o==l.StageMode.edit?(x.addChild(c),x.addChild(h),x.addChild(u),x.addChild(d)):(x.removeChild(c),x.removeChild(h),x.removeChild(u),x.removeChild(d)),t.update()}),s.on("dragover",function(i){i.preventDefault(),t.dispatchEvent(s)}),s.on("drop",function(){const i=e;s.event[i(505)]||t.dispatchEvent(s)}),s.on("mousedown",function(i){s.event.defaultPrevented||t.popupMenu.hide()}),s.on("mouseup",function(i){const r=e;s.button==2?!s.isDragEnd&&t[r(507)].showAt(s.x,s.y):t.popupMenu[r(469)]()}),s.on("mousemove",function(){}),n.selectedGroup.on(l.EventNames[e(466)],function(i){const r=e;t[r(481)](i,n.selectedGroup[r(486)]())}),n.selectedGroup.on(l.EventNames.groupdragend,function(i){t.selectedGroupDragEndHandler(i,n.selectedGroup.getNoChildrensObjects())}))}[y(502)](){const e=y;let t=this.editor,n=t.stage,s=n.selectedGroup;if(Ee!="1")return null;let x=s.getNoChildrensObjects();s.removeAll(),t.instanceManager[e(498)](x);let i=new w("delete");i.object=x,t[e(499)](i)}mousedownHandler(e){const t=y,n=this[t(513)],s=n.stage[t(501)];let x=n.handlerLayer,i=n.nodeCtrlBox,r=n[t(520)];if(n.alignManager[t(492)](s),n.controlTarget=x.pickUpChild(),n.anchorBox[t(469)](),n[t(517)]!=null){let o=n.controlTarget.parent;o!==i?i.hide():o!==r&&r[t(469)](),n.controlTarget.mousedownHandler(s),s[t(467)].preventDefault();return}r[t(469)](),i.hide()}mousewheelHandler(e){}dblclickHandler(e){}mouseupHandler(e){const t=y,n=this[t(513)],s=n.stage.inputSystem;n[t(494)].hideGuidLine(),n.alignManager.mouseupHandler(s);let x=n.stage,i=n.nodeCtrlBox,r=n[t(520)],o=n[t(517)];if(o!=null){s.isDragEnd&&!(o instanceof st)&&n.recordEnd(t(480)),o[t(510)](s),s.event.preventDefault(),n.update();return}if(s.button==2)return;let c=x[t(501)].target;c!=null?(c.editable&&(c instanceof l.Link?r.attachTo(c):i.attachTo(c)),n.anchorBox.canConnectable(c)&&n.anchorBox[t(475)](c)):(n.anchorBox[t(485)](),i.clearTarget(),r.clearTarget());{if(n[t(464)].currObject!=null){let d=n.selectedGroup.getNoChildrensObjects(),u=ne(n,d),f=u.parent;u.objects[t(470)](S=>{S[t(500)](f),S.upgradeLinks()})}n.dropToBox.attachTo(null)}}mousedragHandler(e){const t=y,n=this.editor,s=n.stage.inputSystem;if(s[t(482)]==2)return;n.keyboard.isKeydown(t(511))&&n[t(461)][t(478)](l.Cursor.crosshair),n.guidlineManager.showGuildLine(s);let x=n.controlTarget;if(x!=null){if(s.isDragStart&&!(x instanceof st)&&n[t(472)](t(480)),x[t(471)](s),s.event instanceof MouseEvent&&s[t(467)].defaultPrevented==!![])return;s.event.preventDefault();return}n.alignManager.mousedragHandler(s),n.dropToBox.hide();const i=n.KeysConfig[t(488)];if(n.stage.inputSystem[t(519)]&&n.keyboard.isKeydown(i)){let o=n.selectedGroup.getNoChildrensObjects(),c=ne(n,o),h=c[t(506)];h!=null&&h.editable&&n.dropToBox[t(460)](h)}}mousemoveHandler(e){const t=y,n=this[t(513)];let s=n.stage;const x=s.handlerLayer;if(s.localView.getObject(),s[t(478)]("auto"),n.keyboard.isKeydown(t(459))&&n.anchorBox.findConnectableEndpoint([]))return;let i=x[t(489)]();if(i!==n.mouseOverTarget&&(n.mouseOverTarget!=null&&n.mouseOverTarget.mouseoutHandler(e),i!=null&&i.mouseenterHandler(e)),n[t(491)]=i,i!=null){i.mousemoveHandler(e);return}let r=s.getCurrentLayer()[t(489)]();r!=null&&(n.stage.setCursor("move"),r[t(468)]&&n.anchorBox.canConnectable(r)&&n[t(484)].setTarget(r))}mouseenterHandler(e){const t=y,n=this.editor;n[t(520)].mouseenterStageHandler(),n[t(495)].mouseenterStageHandler(),n[t(484)][t(504)]()}[y(521)](e){const t=y,n=this.editor;n[t(520)].mouseoutStageHandler(),n.nodeCtrlBox.mouseoutStageHandler(),n.anchorBox.mouseoutStageHandler()}onLineDrawnHandler(e){const t=y,n=this.editor;if(n.onLinkCreate)n[t(479)](e);else{let s=new w("lineDrawn");s.object=e,n[t(499)](s),s=new w("drawLineStart"),s.object=e,n.dispatchEvent(s)}}[y(514)](e){const t=y,n=this[t(513)];let s=new w(t(477));s[t(518)]=e,n[t(499)](s),s=new w("drawLineEnd"),s.object=e,n.dispatchEvent(s)}[y(481)](e,t){const n=y,s=this.editor;if(s.stage.inputSystem.isDragStart&&s.record(n(497)),t[n(515)]==1){const i=t[0],r=s.getCurrentLayer()[n(490)](i._obb.aabb),o=r[n(496)]();s.guidlineManager.showGuildLine(o)}}selectedGroupDragEndHandler(e,t){const n=y,s=this.editor;if(!s[n(461)].inputSystem.isMouseOn){s.recordInterrupt();return}t[n(470)](i=>{const r=n;i.isNode&&(i.x=Math.round(i.x),i.y=Math[r(474)](i.y))}),s.recordEnd("对象拖拽")}}(function(a,e){const t=O,n=a();for(;[];)try{if(parseInt(t(166))/1*(-parseInt(t(156))/2)+parseInt(t(170))/3+parseInt(t(168))/4+-parseInt(t(146))/5+parseInt(t(161))/6*(-parseInt(t(160))/7)+-parseInt(t(148))/8+parseInt(t(171))/9===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Gt,384273);function Gt(){const a=["778668JcAXqP","8626509lLJAEo","1770905zGrnXe","shapeLayout","854672PAYGyr","垂直中心对齐","easeInQuart","updatezIndex","isAlone","下移一层","editor","上移一层","23014GvwXor","底部对齐","水平中心对齐","getUnionRect","7nykImL","2896176EiKWGa","stage","getBottom","getCenter","移至顶部","34otCLCF","length","2004660HxzJXb","getRight"];return Gt=function(){return a},Gt()}function O(a,e){const t=Gt();return O=function(n,s){return n=n-146,t[n]},O(a,e)}class He{constructor(e){const t=O;this[t(154)]=e}setZIndex(e,t){const n=O;t==n(155)?e.zIndex++:t==n(153)?e.zIndex--:t==n(165)?e.zIndex=1e3:t=="移至底部"&&(e.zIndex=0),e.parent[n(151)]()}evenSpacing(e){const t=O;let s=this[t(154)].stage.selectedGroup.getNoChildrensObjects();s=s.filter(x=>x.isNode||x instanceof l.Link&&x[t(152)]()),s.length!=0}align(e){const t=O,n=this.editor;let s=n.stage.selectedGroup.getNoChildrensObjects();if(s=s.filter(r=>r.isNode||r instanceof l.Link&&r[t(152)]()),s.length==0)return;let x=s.map(r=>r._obb.aabb),i=l.Rectangle.unionRects(x);for(let r=0;r<s[t(167)];r++){let o=s[r],c=o._obb.aabb;e=="左对齐"?o.translateWith(i.x-c.x,0):e=="右对齐"?o.translateWith(i.getRight()-c[t(169)](),0):e=="顶部对齐"?o.translateWith(0,i.y-c.y):e==t(157)?o.translateWith(0,i.getBottom()-c[t(163)]()):e==t(158)?o.translateWith(0,i.getCenter().y-c[t(164)]().y):e==t(149)&&o.translateWith(i.getCenter().x-c.getCenter().x,0)}n.update()}doGridLayout(){const e=O;let t=this[e(154)],n=t[e(162)],s=n.selectedGroup.getNoChildrensObjects().filter(d=>d instanceof l.Node);if(s.length<2)return;let x=Math.ceil(Math.sqrt(s.length)),i=l.NodeHelper[e(159)](s),r=i.getCenter(),o=l.Shape.outerGrid(x,x),c=n.layoutSystem[e(147)](s,o),h=s[0].width*x;c.resizeTo(h,h),c.translate(r.x,r.y),c.doLayout({effect:e(150),duration:300}),t.showOpTooltip("网格布局")}}const F=Ft;(function(a,e){const t=Ft,n=a();for(;[];)try{if(-parseInt(t(193))/1*(parseInt(t(186))/2)+-parseInt(t(173))/3+-parseInt(t(190))/4+-parseInt(t(174))/5+-parseInt(t(189))/6+-parseInt(t(177))/7+-parseInt(t(178))/8*(-parseInt(t(187))/9)===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Rt,864570);function Ft(a,e){const t=Rt();return Ft=function(n,s){return n=n-172,t[n]},Ft(a,e)}function Rt(){const a=["133747syjfcw","stage","isLink","addNewInstance","2998899HhqyzM","4849310YNoTjO","showOpTooltip","onLineDrawnHandler","9627289uEiofj","50558928jVBECJ","indexOf","editor","onlineDrawingFinishedHandler","Node","zIndex","LinkClassName","css","14dtFyLl","9MosevG","Link","2288700hkpsVw","3171180wrkkEn","delete","create"];return Rt=function(){return a},Rt()}class Me{constructor(e){this.editor=e}[F(191)](e){const t=F;let n=this.editor;n.record("删除"),e.forEach(function(s){l.LinkHelper.disconnect(s),s.removeFromParent()}),n[t(175)]("删除"),n.recordEnd("删除")}[F(172)](e){const t=this.editor;this.editor.stage.localView.getObject().addChild(e);let s=new w("create");s.object=e,t.dispatchEvent(s)}[F(192)](e){const t=F;let x=this[t(180)][t(194)].localView.getMouseXY(),i=x.x,r=x.y,o=l.getClass(e);if(e[t(179)](t(182))!=-1){let c=new o(null,i,r,64,64);return this.addNewInstance(c),c}if(e.indexOf("Link")!=-1){let c=new o(null,{x:i-40,y:r},{x:i+40,y:r+(e==t(188)?0:80)});return this[t(172)](c),c}throw new Error("unknow classname:"+e)}lineDrawn(e,t,n,s){const x=F;let i=this[x(180)],r=l.getClass(i[x(184)]);const o=new r(e,t,n,s),c=Object.assign({},i.newLinkProperties);c.css&&(o.css(c[x(185)]),delete c.css),Object.keys(c).forEach(u=>{let f=c[u];typeof f=="function"?o[u]=f():o[u]=f});let d=t.isNode||t[x(195)]?t.parent:i.currentLayer;return o[x(183)]=l.DefaultZIndexs.EditorNewLink,d.addChild(o),i.editorEventManager[x(176)](o),o}lineDrawingFinished(e){const t=F;this[t(180)].editorEventManager[t(181)](e)}}const tt=B;(function(a,e){const t=B,n=a();for(;[];)try{if(parseInt(t(285))/1+-parseInt(t(250))/2+parseInt(t(266))/3*(parseInt(t(278))/4)+parseInt(t(262))/5+parseInt(t(245))/6*(-parseInt(t(252))/7)+-parseInt(t(282))/8+parseInt(t(273))/9===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Wt,331518);function B(a,e){const t=Wt();return B=function(n,s){return n=n-240,t[n]},B(a,e)}function Wt(){const a=["dyLine","102ajeHHT","css","center","getAlignInfo","_obb","285998gcUBLX","addChild","105322EXoyry","length","bottom","alignLineStyle","DiableNodeAlign","yType","toStageRect","mousedragHandler","right","minDistance","391715dIamaJ","isNode","isIntersectRect","displayList","3xRqbxJ","handlerLayer","visible","mouseEnabled","align","stageToLocalXY","left","3969648YfHCJA","target","editor","distance","init","2021456WuZpUW","_disabled","parent","xType","4649784wzcFkG","hide","abs","286743jXTyow","endArrow","map","dxLine","middle","isKeydown"];return Wt=function(){return a},Wt()}class Ne{constructor(e){const t=B;this[t(261)]=p.align[t(261)],this._disabled=![],this.visible=![],this.editor=e,this[t(277)](e)}init(e){const t=B;let n=new l.Link(null,{x:0,y:0},{x:100,y:100});n[t(246)](p.align[t(255)]),n[t(269)]=![],this.dxLine=n;let s=new l.Link(null,{x:0,y:0},{x:100,y:100});s.css(p[t(270)].alignLineStyle),s.mouseEnabled=![],this.dyLine=s,n.hide(),s[t(283)](),e[t(267)][t(251)](n),e[t(267)].addChild(s)}disable(){this._disabled=!![],this.dxLine.hide(),this.dyLine.hide()}enable(){const e=B;this[e(279)]=![]}[tt(248)](e,t){const n=tt,s=this.editor,x=s.stage;let i=e.target;if(x.selectedGroup.objects[n(253)]>1)return null;let r=this.editor.getCurrentLayer(),o=u=>u.isNode&&u!==i&&u!==u[n(280)].beginArrow&&u!==u.parent[n(286)]&&u!==u.parent.label;const c=x.getCurrentLayer()[n(265)].filter(o),h=c[n(240)](u=>r[n(258)](u[n(249)].aabb));return this.findAlignRectInfo(r[n(258)](i._obb.aabb),h,t)}mousedownHandler(e){}mouseupHandler(e){const t=tt;if(this._disabled)return;let n=!this.dxLine.visible&&!this.dyLine[t(268)];if(this[t(241)].hide(),this.dyLine.hide(),n)return;let s=e.target,x=this.alignInfo;if(s&&s.isNode&&x!=null){if(this.editor.getCurrentLayer(),x.xType!=null){let i=x.xRect,r=x.xType,o=i[x[t(281)]];o=s.parent[t(271)](o,0).x,r==t(272)?s.left=o:r=="center"?s.x=o:r=="right"&&(s[t(260)]=o)}if(x.yType!=null){let i=x.yRect,r=x.yType,o=i[x[t(257)]];o=s.parent[t(271)](0,o).y,r=="top"?s.top=o:r==t(242)?s.y=o:r==t(254)&&(s.bottom=o)}this.editor.update(),this.alignInfo=null}}[tt(259)](e){const t=tt;if(this._disabled)return;let n=e[t(274)];if(n==null||!n[t(263)]||(this.dxLine.hide(),this[t(244)].hide(),this[t(275)].keyboard[t(243)](ht[t(256)])))return;let s=this.dxLine,x=this.dyLine;const i=this.getAlignInfo(e,this[t(261)]);if(this.alignInfo=i,i==null)return;let r=i.rect;if(i.xType!=null){let o=i.xRect,c=o[i[t(281)]],h=(r.middle+o.middle)/2,d=Math.abs(r.middle-o.middle);s.setBegin({x:c,y:h-d/2}),s.setEnd({x:c,y:h+d/2}),s.show()}if(i[t(257)]!=null){let o=i.yRect,c=(r.center+o.center)/2,h=o[i[t(257)]],d=Math.abs(r.center-o[t(247)]);x.setBegin({x:c-d/2,y:h}),x.setEnd({x:c+d/2,y:h}),x.show()}}findAlignRectInfo(e,t,n){const s=tt;let x=Number.MAX_VALUE,i=Number.MAX_VALUE,r,o,c,h;t.sort((u,f)=>{const b=B;return l.Point[b(276)](e.center,e[b(242)],f[b(247)],f.middle)-l.Point[b(276)](e.center,e.middle,u.center,u.middle)});let d;for(let u=0;u<t.length;u++){let f=t[u];f[s(264)](e)||(d=Math.abs(e.top-f.top),d<=i&&d<=n&&(o="top",i=d,h=f),d=Math[s(284)](e.bottom-f.bottom),d<=i&&d<=n&&(o="bottom",i=d,h=f),d=Math.abs(e.middle-f.middle),d<=i&&d<=n&&(o="middle",i=d,h=f),d=Math.abs(e.left-f.left),d<=x&&d<n&&(r="left",x=d,c=f),d=Math.abs(e.right-f[s(260)]),d<=x&&d<n&&(r="right",x=d,c=f),d=Math.abs(e.center-f[s(247)]),d<=x&&d<n&&(r="center",x=d,c=f))}return{x,y:i,rect:e,xRect:c,yRect:h,xType:r,yType:o}}}const _=R;(function(a,e){const t=R,n=a();for(;[];)try{if(-parseInt(t(158))/1*(-parseInt(t(163))/2)+parseInt(t(177))/3+parseInt(t(191))/4+parseInt(t(192))/5*(parseInt(t(170))/6)+-parseInt(t(173))/7*(-parseInt(t(193))/8)+-parseInt(t(148))/9+-parseInt(t(197))/10===e)break;n.push(n.shift())}catch{n.push(n.shift())}})(Vt,832376);function Vt(){const a=["mouseupHandler","nodeCtrlBox","showOpTooltip","showTip","msg","update","11922858cbxLfT","fadeOut","getCurrentLayer","targetOnly","serializerSystem","restoreToJson","newLinkProperties","KeysConfig","guidlineManager","log","2071JltjRC","lineDrawn","sendKey","opTooltip","recordName","114nOBuoN","keyboard","recordEnd","open","dispatchEvent","saveHandler","camera","6qEbxux","onEsc","mousedragHandler","77MgJMwl","operationTip","DataCenter","dblclickHandler","4086429fjIhOE","instanceManager","mousemoveHandler","dropToBox","EditorConfig","clearTarget","redoUndoSys","push","setHtml","editorEventManager","stage","toogleLocalView","isDraging","linkCtrlBox","289928feTQwT","5924895fYseWf","53992cMaVWL","record和recordEnd没有成对出现","getItem","popupMenu","6547520LIEeUX","selectedGroupDragEndHandler"];return Vt=function(){return a},Vt()}function R(a,e){const t=Vt();return R=function(n,s){return n=n-144,t[n]},R(a,e)}class qt extends l.EventTarget{constructor(e){const t=R;super(),this.KeysConfig=ht,this[t(181)]=p,this.LinkClassName="AutoFoldLink",this[t(154)]={},this[t(175)]=Ie,this.imageToBase64=![],this.stage=e,e.editor=this,this.currentLayer=this.getCurrentLayer(),this.handlerLayer=e.handlerLayer,this.selectedGroup=this.stage.selectedGroup,this.keyboard=e[t(164)],this.clipboardManager=new ve(this),this[t(178)]=new Me(this),this.editorEventManager=new Te(this),this.keyManager=new Ce(this),this[t(200)]=new oe(this),this[t(190)]=new le(this),this.anchorBox=new pe(this),this[t(180)]=new Se(this),this[t(196)]=Pe(this),this.stage.inputSystem.target=null,this.controlTarget=null,this.mouseOverTarget=null,this.inputTextfield=new l.InputTextfield(this),this[t(183)]=new ye(this),this.layoutManager=new He(this),this[t(156)]=new Le(this),this.alignManager=new Ne(this),this[t(161)]=new l.Tooltip(e),Object.assign(this.opTooltip.domElement.style,{paddingLeft:"20px",paddingRight:"20px",color:"black"})}setLinkClassName(e){this.LinkClassName=e}getCurrentLayer(){return this[R(187)].getCurrentLayer()}defineKeys(e){Object.assign(this[R(155)],e)}[_(144)](e){const t=_;p[t(174)].enable&&(this.opTooltip[t(185)](e),this.opTooltip.showAt(this.stage.width*.5,this[t(187)].height*.5),this[t(161)][t(149)](80))}[_(168)](e,t=![]){const n=_;let s=this[n(150)](),x=s.toFileJson({imageToBase64:t});this.DataCenter.setItem(p.data.localLastDocName,x);const i=new w("save");i.object=x,i.imageToBase64=t,this[n(167)](i)}openLasted(){const e=_,t=this.getCurrentLayer(),n=this.DataCenter[e(195)](p.data.localLastDocName);return n!=null?t.openJson(n):null}dblclickHandler(e){const t=_;this.editorEventManager[t(176)](e),this[t(147)]()}mousewheelHandler(e){this.editorEventManager.mousewheelHandler(e),this.update()}mousedownHandler(e){const t=_;this[t(186)].mousedownHandler(e),this[t(147)]()}mouseupHandler(e){const t=_;this[t(186)][t(199)](e),this.update()}mousedragHandler(e){const t=_;this.editorEventManager[t(172)](e),this.update()}[_(179)](e){const t=_;if(this.stage.inputSystem[t(189)])return this.mousedragHandler(e);this.editorEventManager.mousemoveHandler(e),this.update()}mouseenterHandler(e){const t=_;this[t(186)].mouseenterHandler(e),this[t(147)]()}mouseoutHandler(e){this[_(186)].mouseoutHandler(e),this.update()}selectedGroupDragHandler(e,t){this.editorEventManager.selectedGroupDragHandler(e,t)}selectedGroupDragEndHandler(e,t){const n=_;this[n(186)][n(198)](e,t)}recordInterrupt(){this.recordName=null,this.lastLayerState=null}record(e){const t=_;let n=this.currentLayer,s=n.stage[t(152)];this.recordName!=null&&console.warn(t(194),this.recordName+":"+e),this.recordName=e,this.lastLayerState=s.getState(this.currentLayer)}[_(165)](e){const t=_;e!=this[t(162)],this.recordName=null;let n=this.currentLayer,s=n.stage.serializerSystem,x=this.lastLayerState,i=s.getState(n);this.redoUndoSys[t(184)](e,function(){s.restoreToJson(n,i)},function(){s[t(153)](n,x)})}newLink(e,t,n,s){const x=_;return this[x(178)][x(159)](e,t,n,s)}update(){const e=_;this.dropToBox.update(),this.nodeCtrlBox[e(147)](),this.anchorBox[e(147)](),this.stage.update()}toJson(e=![]){return this.getCurrentLayer().toFileJson(e)}openJson(e){const t=_;this.getCurrentLayer().openJson(e);let n=new w(t(166));n.object=e,this.dispatchEvent(n)}[_(145)](e,t=""){const n=_;let s=new Event(n(157));s[n(146)]=e+t,this.dispatchEvent(s)}create(e){return this.instanceManager.create(e)}clearCtrlBoxs(){const e=_;this.anchorBox[e(182)](),this.nodeCtrlBox[e(182)](),this[e(190)].clearTarget()}[_(188)](){const e=_;let t=this.stage.inputSystem.target;this[e(187)][e(169)][e(151)](t),this.clearCtrlBoxs(),this.update()}[_(160)](e,t){this[_(164)].sendKey(e,t)}[_(171)](){this.anchorBox.cancel()}}qt.KeysConfig=ht,l.jtopo.Editor=qt,function(a,e){for(var t=Qt,n=a();[];)try{var s=parseInt(t(267))/1+-parseInt(t(275))/2*(-parseInt(t(274))/3)+-parseInt(t(271))/4*(parseInt(t(276))/5)+-parseInt(t(272))/6+-parseInt(t(268))/7*(parseInt(t(265))/8)+parseInt(t(270))/9*(parseInt(t(266))/10)+parseInt(t(273))/11*(-parseInt(t(269))/12);if(s===e)break;n.push(n.shift())}catch{n.push(n.shift())}}(Kt,366597);function Kt(){var a=["11pHzPMa","618JeMPbQ","1662uqCBfM","1345690ZxpVsh","870856LJuNlr","70rLJJkV","550719cBqtnS","7QuoZJf","4611084ljTgym","919386MFRwqg","8fkXIWI","233976zVVWxl"];return Kt=function(){return a},Kt()}function Qt(a,e){var t=Kt();return Qt=function(n,s){n=n-265;var x=t[n];return x},Qt(a,e)}T.Editor=qt,T.IconsPanel=se,T.PropertiesPanel=xe,Object.defineProperty(T,Symbol.toStringTag,{value:"Module"})});
